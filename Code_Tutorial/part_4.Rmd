---
title: "Part 4: Plotting a Graph"
author: "Benjamin Ortiz Ulloa"
date: "4/14/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = F}
library(tidyverse)
library(ggraph)
library(igraph)
library(igraphdata)
```

Before we try to tackle a big dataset, let's try to plot a graph that we know has structure. 

```{r}
tree_g <- make_tree(40, 4) %>%
  set_edge_attr('weight', value = sample(1:3, ecount(.), replace = T)) %>%
  set_vertex_attr('degree', value = degree(.))
```

```{r}
set.seed(1234)
plot(tree_g)
```
```{r}
set.seed(1234)
plot(tree_g,
     vertex.size = 5,
     vertex.label = 'node',
     vertex.label.cex = .75,
     edge.width = 2,
     edge.arrow.size = .5)
```
```{r}
set.seed(1234)
plot(tree_g,
     vertex.size = V(tree_g)$degree * 3,
     vertex.label = ifelse(1:vcount(tree_g) %% 2, 'node', 'vertex'),
     vertex.label.cex = sample(c(.5, 1), vcount(tree_g), replace = T),
     edge.width = E(tree_g)$weight,
     edge.arrow.size = .5)
```

```{r}
set.seed(1234)
plot(tree_g,
     vertex.label = NA,
     vertex.size = 10,
     vertex.color = 'hotpink',
     edge.color = 'midnightblue',
     edge.arrow.size = .5)
```

```{r}
set.seed(1234)
plot(tree_g,
     vertex.label = NA,
     vertex.size = 10,
     vertex.color = map_chr(V(tree_g)$degree, function(x){switch(as.character(x), "4" = 'red', "5" = 'white', "1" = 'blue')}),
     edge.color = map_chr(E(tree_g)$weight, function(x){rgb(0, 0, 1, x/3)}),
     edge.arrow.size = .5)
```

```{r}
V(tree_g)$color = map_chr(V(tree_g)$degree, function(x){switch(as.character(x), "4" = 'red', "5" = 'white', "1" = 'blue')})
V(tree_g)$size = V(tree_g)$degree * 4
V(tree_g)$label = NA
E(tree_g)$color = map_chr(E(tree_g)$weight, function(x){rgb(0, 0, 1, x/3)})
E(tree_g)$width = E(tree_g)$weight
E(tree_g)$arrow.size = .3
```

```{r}
set.seed(1234)
plot(tree_g)
```

```{r}
plot(tree_g, layout = layout_as_tree)
```

```{r}
plot(tree_g, layout = layout_as_tree(tree_g, circular = T))
```

If you want to create your own matrix, then the first column of the matrix is the horizontal location (x) and the second column of the matrix is the vertical location (y). The default of `igraph.plot` is to make the x location dependent on the y location. If you do not want this behaviour, then change the aspect ration `asp` parameter to 0.

```{r}
myLayout = cbind(c(vcount(tree_g)/2, 
                    1:4, 
                    map_dbl(1:16, function(x){vcount(tree_g) - x}),
                    map_dbl(1:19, function(x){vcount(tree_g)/2 - x})),
                 c(1, rep(vcount(tree_g)/4, 4), rep(vcount(tree_g)/2, 16), rep(vcount(tree_g), 19)))
```

```{r}
plot(tree_g, layout = myLayout, asp = 0)
axis(1, at = c(-1, 0, 1), labels = c('0', 'vcount/2', 'vcount'))
axis(2, at = c(-1, 0, 1), labels = c('0', 'vcount/2', 'vcount'))
```

```{r}
data(enron)
enron
```

```{r}
graph_attr(enron) %>%
  lapply(head)
```

```{r}
vertex_attr(enron) %>% 
  lapply(head)
```

There's no `name` attribute (it has to be lower case), so let's make one now. Remember, the `name` attribute has to be unique for each node.
```{r}
vertex_attr(enron) %>%
  lapply(function(x){x %>% unique %>% length})

```

So it seems that the `Email` attribute is the best candidate for the `name` because the number of unique `Emails` matches the number of unique nodes (`r vcount(enron)`)

```{r}
V(enron)$name <- V(enron)$Email
```

```{r}
edge_attr(enron) %>%
  lapply(head)
```


```{r}
set.seed(1234)
plot(enron,
     vertex.size = 5,
     edge.color = 'lightgrey',
     edge.arrow.size = .1,
     vertex.label = NA)
```

## Filter

Let's take a look at the the years really fast

```{r}
E(enron)$Time %>%
  str_extract('\\d{4}\\-\\d{2}') %>%
  unique %>%
  sort
```

Did you know that Enron was founded in 1985? I think this  might be something looking into. Let's filter the graph down to only include edges from 1979.

```{r}
old_enron <- enron - E(enron)[!str_detect(E(enron)$Time, '^1979')]
old_enron
```

```{r}
plot(old_enron,
     vertex.label = NA,
     edge.arrow.size = .1)
```

## Aggregate
## Query